angular.module("app").factory("serviceUpdate",["$log","$q","serviceIonicWrapper",function(a,b,c){var d=new CordovaPromiseFS({persistent:isCordova,Promise:b}),e=new CordovaAppLoader({fs:d,serverRoot:app.datas.app.provider.appLoader.serverPath?app.datas.app.provider.appLoader.serverRoot+"/"+app.datas.app.provider.appLoader.serverPath:app.datas.app.provider.appLoader.serverRoot,localRoot:app.datas.app.provider.appLoader.dataPath?".mobC/"+app.datas.app.provider.appLoader.dataPath+"/":".mobC",mode:"mirror",cacheBuster:!0,checkTimeout:1e4,manifest:"manifest.json?"+Date.now()}),f={check:function(){var a=b.defer();return e.check().then(function(b){b?c.popup.confirmNoYes("App updaten ?",function(b){b?a.resolve(b):a.reject(b)}):a.reject(b)}),a.promise},download:function(a){var c=b.defer();return e.download(a).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},update:function(a){e.update(a)},isFileCached:function(a){return angular.isDefined(e.cache)?e.cache.isCached(a):!1},getCachedUrl:function(a){return angular.isDefined(e.cache)?e.cache.get(a):a},getCachedHtmlUrl:function(a){return angular.isDefined(e.cache)?e.cache.getForHtml(a):a}};return f}]),angular.module("app").directive("img",["$timeout","serviceUpdate",function(a,b){return{restrict:"E",priority:1002,link:function(c,d,e){e.$observe("ngSrc",function(c){a(function(){b.isFileCached(c)&&d.attr("src",b.getCachedHtmlUrl(c))},500,!0)})}}}]),window.BOOTSTRAP_OK=!0;var isCordova="undefined"!=typeof cordova;angular.module("app").run(["$rootScope","$ionicPlatform","$window","serviceUpdate",function(a,b,c,d){function e(){d.check().then(function(){return d.download()}).then(function(){return d.update(!0)},function(a){a&&console.error("Auto-update error:",a)})}function f(){document.webkitHidden||e()}window.BOOTSTRAP_OK=!0,b.ready(function(){c.BOOTSTRAP_OK=!0,e(),a.$on("$rootScope.mobcEvent",function(a,b){"checkUpdate"===b.name&&e()}),c.cordova||document.addEventListener("webkitvisibilitychange",f,!1)})}]);